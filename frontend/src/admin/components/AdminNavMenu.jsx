import { useState, useEffect } from "react";
import "./AdminNavMenu.css";
import { useDispatch } from "react-redux";
import { useNavigate } from "react-router-dom";
import { logout } from "../features/auth/adminAuthSlice";
import { toast } from "react-toastify";

function AdminNavMenu() {
  const [selectedMenu, setSelectedMenu] = useState("earnings");
  const dispatch = useDispatch();
  const navigate = useNavigate();

  const menuItems = [
    { key: "earnings", label: "Earnings" },
    { key: "users", label: "Users" },
    { key: "products", label: "Products" },
  ];

  useEffect(() => {
    const path = window.location.pathname;
    const activeMenu = path.split("/")[2];
    setSelectedMenu(activeMenu || "earnings");
  }, []);

  useEffect(() => {
    if (window.location.pathname === "/admin") {
      navigate("/admin/earnings");
    }
  }, [navigate]);

  const menuClickHandler = (menu) => {
    setSelectedMenu(menu);
    navigate(`/admin/${menu}`);
  };

  const logoutHandler = async (e) => {
    e.preventDefault();

    try {
      const response = await fetch("/api/admin/logout", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        credentials: "include",
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message);
      }

      dispatch(logout());
      navigate("/admin/login");
    } catch (err) {
      toast.error(err?.message);
    }
  };

  return (
    <div className="admin-nav-container">
      <div className="admin-nav-minipages">
        <ul className="admin-nav-minipages-list">
          {menuItems.map((menuItem) => (
            <li
              key={menuItem.key}
              className={`single-admin-nav-minipage ${
                selectedMenu === menuItem.key ? "active" : ""
              }`}
              onClick={() => menuClickHandler(menuItem.key)}
            >
              {menuItem.key === "earnings" && (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="25"
                  height="25"
                  viewBox="0 0 512 512"
                  version="1.1"
                >
                  <path
                    d=""
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#080404"}
                    fillRule="evenodd"
                  />
                  <path
                    d="M 237.191 43.056 C 203.711 46.036, 166.150 59.140, 138.712 77.415 C 82.536 114.829, 48.262 173.427, 42.884 241.250 C 40.438 272.093, 46.801 311.089, 58.665 337.959 L 61.075 343.418 113.790 290.710 L 166.506 238.001 196.751 268.247 L 226.996 298.492 260.498 265.002 C 278.924 246.582, 294 231.063, 294 230.515 C 294 229.967, 285.567 221.077, 275.260 210.760 L 256.520 192 309.260 192 L 362 192 362 244.747 L 362 297.493 343.254 278.747 L 324.507 260 275.755 308.745 L 227.002 357.490 196.746 327.246 L 166.489 297.002 124.614 338.886 C 94.613 368.893, 82.969 381.157, 83.550 382.135 C 83.996 382.886, 87.080 386.875, 90.403 391 C 133.046 443.924, 202.741 474.195, 270.244 469.112 C 377.943 461.002, 460.801 378.342, 469.083 270.750 C 473.123 218.253, 455.621 162.890, 421.810 121.212 C 388.536 80.196, 339.305 52.217, 287 44.595 C 273.382 42.610, 250.235 41.895, 237.191 43.056"
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#040404"}
                    fillRule="evenodd"
                  />
                </svg>
              )}
              {menuItem.key === "users" && (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="25"
                  height="25"
                  viewBox="0 0 512 512"
                  version="1.1"
                >
                  <path
                    d=""
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#080404"}
                    fillRule="evenodd"
                  />
                  <path
                    d="M 240.365 108.493 C 226.016 111.614, 213.876 118.268, 202.949 129 C 179.673 151.863, 173.849 186.939, 188.504 215.998 C 196.166 231.191, 207.647 242.675, 222.417 249.919 C 234.629 255.909, 241.421 257.427, 256 257.427 C 270.579 257.427, 277.371 255.909, 289.583 249.919 C 328.776 230.696, 343.147 181.685, 320.785 143.500 C 315.926 135.202, 303.755 122.882, 295.736 118.145 C 278.884 108.190, 258.277 104.598, 240.365 108.493 M 109.500 165.036 C 86.571 168.103, 68.442 184.276, 62.459 207 C 60.094 215.982, 60.057 231.713, 62.382 239.448 C 68.336 259.248, 82.994 273.524, 102.460 278.482 C 110.115 280.432, 123.942 280.427, 131.448 278.472 C 145.853 274.719, 160.239 263.659, 166.776 251.310 L 170.053 245.121 166.332 239.311 C 157.250 225.129, 152.186 208.073, 151.295 188.670 L 150.706 175.840 146.740 173.336 C 135.882 166.482, 121.931 163.372, 109.500 165.036 M 386.500 165.033 C 378.867 166.050, 370.358 169.233, 365.105 173.039 L 361 176.013 360.992 183.756 C 360.977 199.615, 356.742 215.865, 348.034 233.476 L 342.112 245.453 345.241 250.976 C 346.962 254.014, 351.549 259.664, 355.435 263.530 C 366.922 274.961, 379.083 280, 395.184 280 C 411.327 280, 424.661 274.343, 435.433 262.924 C 446.307 251.397, 451.398 238.083, 451.272 221.500 C 451.009 186.780, 420.821 160.462, 386.500 165.033 M 237.500 273.013 C 212.887 277.454, 190.693 289.285, 173.474 307.140 C 153.641 327.707, 143.523 349.844, 140.890 378.430 C 139.356 395.089, 141.484 401.044, 150.421 405.104 C 154.304 406.867, 159.310 406.957, 254.500 406.972 C 317.114 406.983, 355.825 406.621, 358.044 406.004 C 362.065 404.887, 367.360 399.872, 368.939 395.685 C 371.438 389.057, 369.680 368.059, 365.375 353.112 C 360.203 335.155, 351.146 320.042, 337.066 305.875 C 321.922 290.638, 305.854 281.259, 284.894 275.422 C 276.898 273.196, 273.044 272.755, 259 272.459 C 249.925 272.268, 240.250 272.517, 237.500 273.013 M 101.342 290.412 C 72.353 295.946, 50.201 313.018, 38.093 339.156 C 33.013 350.122, 30.992 358.316, 30.362 370.500 C 29.754 382.278, 31.169 386.040, 37.604 389.741 C 41.452 391.955, 41.909 391.979, 75 391.741 L 108.500 391.500 109.254 380 C 111.172 350.730, 119.781 325.236, 135.440 302.450 C 141.561 293.545, 141.623 293.789, 132.612 291.379 C 124.845 289.302, 109.622 288.831, 101.342 290.412 M 383.763 289.964 C 381.158 290.441, 376.808 291.567, 374.097 292.468 L 369.167 294.105 375.065 302.303 C 378.309 306.811, 383.412 315.450, 386.405 321.500 C 395.688 340.266, 399.792 356.683, 400.725 378.786 L 401.286 392.073 436.071 391.786 C 469.640 391.510, 470.955 391.426, 473.678 389.395 C 478.987 385.436, 480.442 381.556, 480.181 372.052 C 479.155 334.619, 452.675 301.556, 416.015 291.932 C 407.479 289.691, 390.817 288.674, 383.763 289.964"
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#040404"}
                    fillRule="evenodd"
                  />
                </svg>
              )}
              {menuItem.key === "products" && (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="25"
                  height="25"
                  viewBox="0 0 512 512"
                  version="1.1"
                >
                  <path
                    d=""
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#080404"}
                    fillRule="evenodd"
                  />
                  <path
                    d="M 223.972 13.351 C 208.862 20.694, 189.993 29.969, 182.040 33.963 L 167.580 41.224 170.540 42.776 C 198.361 57.366, 399.754 160, 400.561 160 C 401.178 160, 422.342 149.818, 447.591 137.374 L 493.500 114.749 456 96.108 C 435.375 85.856, 383.175 60.031, 340 38.720 C 267.981 3.170, 261.085 -0.028, 256.472 -0.014 C 252.071 -0.002, 248.013 1.667, 223.972 13.351 M 71.500 88.554 L 18.500 114.814 40 125.286 C 51.825 131.045, 105.147 157.436, 158.492 183.931 L 255.485 232.105 265.492 227.449 C 287.814 217.063, 356.336 182.438, 356.255 181.586 C 356.180 180.803, 285.731 144.483, 157 78.861 L 124.500 62.294 71.500 88.554 M -0 268.377 L -0 388.595 117.640 450.048 C 182.342 483.846, 235.668 511.651, 236.144 511.835 C 236.627 512.022, 236.896 457.698, 236.754 388.500 L 236.500 264.830 159.500 226.821 C 117.150 205.915, 63.938 179.664, 41.250 168.485 L 0 148.159 -0 268.377 M 463.789 171.780 L 416.078 195.287 415.789 239.393 C 415.463 289.099, 415.565 288.405, 407.748 294.067 C 398.058 301.087, 384.869 297.525, 379.880 286.541 C 378.216 282.880, 378.042 279.330, 378.022 248.750 C 378.010 230.188, 377.658 215, 377.240 215 C 375.966 215, 276.590 264.089, 275.237 265.387 C 274.225 266.357, 274.108 291.049, 274.652 389.327 C 275.025 456.828, 275.688 511.931, 276.125 511.778 C 276.563 511.625, 327.817 484.950, 390.023 452.500 C 467.647 412.008, 504.209 392.424, 506.577 390.069 C 508.475 388.182, 510.491 385.032, 511.056 383.069 C 511.741 380.690, 511.987 340.954, 511.792 263.887 L 511.500 148.274 463.789 171.780"
                    stroke="none"
                    fill={selectedMenu === menuItem.key ? "#FF7C32" : "#040404"}
                    fillRule="evenodd"
                  />
                </svg>
              )}
              <span>{menuItem.label}</span>
            </li>
          ))}
          <button className="admin-logout" onClick={logoutHandler}>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="25"
              height="25"
              viewBox="0 0 512 512"
              version="1.1"
              className="bi-logout-icon"
              fill="#080404"
            >
              <path d="" stroke="none" fillRule="evenodd" />
              <path
                d="M 116.500 52.469 C 87.342 58.936, 64.748 79.268, 54.792 108 L 51.500 117.500 51.206 176.750 L 50.911 236 159.456 236 C 219.155 236, 268 235.674, 268 235.275 C 268 234.876, 256.571 223.064, 242.603 209.025 C 218.528 184.828, 217.154 183.246, 216.195 178.613 C 212.834 162.371, 228.858 149.053, 243.500 155.920 C 248.448 158.241, 334.402 244.140, 335.954 248.315 C 337.298 251.933, 337.298 260.067, 335.954 263.685 C 334.402 267.860, 248.448 353.759, 243.500 356.080 C 228.858 362.947, 212.834 349.629, 216.195 333.387 C 217.154 328.754, 218.528 327.172, 242.603 302.975 C 256.571 288.936, 268 277.124, 268 276.725 C 268 276.326, 219.155 276, 159.456 276 L 50.911 276 51.206 335.250 L 51.500 394.500 54.792 404 C 63.726 429.784, 82.216 448.274, 108 457.208 L 117.500 460.500 256 460.500 L 394.500 460.500 404 457.208 C 416.935 452.726, 427.760 446.046, 436.903 436.903 C 446.046 427.760, 452.726 416.935, 457.208 404 L 460.500 394.500 460.500 256 L 460.500 117.500 457.208 108 C 448.274 82.216, 429.784 63.726, 404 54.792 L 394.500 51.500 258.500 51.319 C 148.453 51.172, 121.355 51.392, 116.500 52.469"
                stroke="none"
                fillRule="evenodd"
              />
            </svg>
            Log out
          </button>
        </ul>
      </div>
    </div>
  );
}

export default AdminNavMenu;
